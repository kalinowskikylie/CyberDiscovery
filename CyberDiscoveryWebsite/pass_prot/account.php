<?php	session_start();//Get configuration file		include('pass_config.php');	if($_SESSION[$session_prefix .'permissions'] < 50){		$_SESSION['referingPage'] = $_SERVER['SCRIPT_NAME'];		header('Location: '. $path_to_pass_folder .'/pass_prot/login.php?error=login');		exit;	} else { 		//Open user database and read contents out of file			$myFile = "users_db.txt";	//This is location of database file			$fh = fopen($myFile, 'r');			$userDb = fread($fh, filesize($myFile));			fclose($fh);					//Seperate file into seperate entries. Delete last entry which should always be null			$userRows = explode('|!|',$userDb);			if($userRows[count($userRows)-1] == ''){				unset($userRows[count($userRows)-1]);			}		//Find current user's key and get all info from table				foreach($userRows as $key => $rows){				$tempUserPieces = explode('(*)',$rows);				$users['fName'][$key] = str_replace("\n",'',$tempUserPieces[0]);				$users['lName'][$key] = $tempUserPieces[1];				$users['camp'][$key] = $tempUserPieces[2];				$users['email'][$key] = $tempUserPieces[3];				$users['password'][$key] = $tempUserPieces[4];				$users['permissions'][$key] = $tempUserPieces[5];			}			$myKey = array_search($_SESSION['fagentemail'],$users['email']);					?>		<!DOCTYPE html>		<html>		<head>		<title>Account</title>		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.pack.js"></script>		<?php			if($pageSetupIncludes == ''){				include('pass_pagesetup.php');			} else {				$webPage = 'admin';				include($pageSetupIncludes);			}		?>			<h1>User Information</h1>			<form action="process_CRUD.php" method="post" onSubmit="return validate()">				<input type="hidden" value="1" name="account" id="account" />				<input type="hidden" value="<?php echo $myKey ?>" name="editUser" id="editUser" />				<input type="hidden" value="<?php echo $users['password'][$myKey] ?>" name="edithpassword" id="edithpassword" />				<input type="hidden" value="<?php echo $users['permissions'][$myKey] ?>" name="editpermissions" id="editpermissions" />				<table>					<tr>						<td><span style="float:right;">First Name:</span></td>						<td><input type="text" id="editfName" name="editfName" value="<?php echo $users['fName'][$myKey] ?>" /></td>					</tr>					<tr>						<td><span style="float:right;">Last Name:</span></td>						<td><input type="text" id="editlName" name="editlName" value="<?php echo $users['lName'][$myKey] ?>" /></td>					</tr>					<tr>						<td><span style="float:right;">Camp:</span></td>						<td><span><?php echo $users['camp'][$myKey] ?></span></td>					</tr>					<tr>						<td><span style="float:right;">Email:</span></td>						<td><input type="text" id="editemail" name="editemail" value="<?php echo $users['email'][$myKey] ?>" /></td>					</tr>					<tr>						<td><span style="float:right;">New Password:</span></td>						<td><input type="password" id="editpassword" name="editpassword" value="HIDDEN" /></td>					</tr>					<tr>						<td><span style="float:right;">Confirm New Password:</span></td>						<td><input type="password" id="confirmpassword" name="confirmpassword" value="HIDDEN" /></td>					</tr>					<tr>						<td></td>						<td><input style="float:right;" type="submit" id="submit" name="submit" value="Update Information" /></td>					</tr>				</table>			</form>			<span style="color:green;" id="successHolder"></span>			<span style="color:red;" id="errorHolder"></span>				<?php if($_GET['error'] == 'email'){ ?>					<script type="text/javascript">						$('#errorHolder').html('<span>That email is already in use. Please try again.</span>').children('span').delay(4000).fadeOut(500);					</script>				<?php } ?>				<?php if($_GET['update'] == '1'){ ?>					<script type="text/javascript">						$('#successHolder').html('<span>Update Successful!</span>').children('span').delay(4000).fadeOut(500);					</script>				<?php } ?>				<script type="text/javascript">				$('#editfName').focus();				function validate(){					var fName = $('#editfName').val();					var lName = $('#editlName').val();					var email = $('#editemail').val();					var pass = $('#editpassword').val();					var repass = $('#confirmpassword').val();					var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/; //email regex								//Check first name					if(fName != ''){						//Check last name						if(lName != ''){							//Check email							if(email != ''){								//check email format								if (filter.test(email)) {									//Check password									if(pass != '' ){										//Check password consistancy										if(pass == repass ){											return true;										} else {//password inconsistancy											$('#errorHolder').html('<span>Passwords do not match. Please try again.</span>').children('span').delay(4000).fadeOut(500);											return false;										}									} else {//no password change										$('#errorHolder').html('<span>You must include a password. Please try again.</span>').children('span').delay(4000).fadeOut(500);										return false;									}								} else {//wrong email format									$('#errorHolder').html('<span>Your email must be of the format username@domain.something . Please try again.</span>').children('span').delay(4000).fadeOut(500);									return false;								}							} else {//no email								$('#errorHolder').html('<span>You msut include your email. Please try again.</span>').children('span').delay(4000).fadeOut(500);								return false;							}						} else {//no last name							$('#errorHolder').html('<span>You must include your last name. Please try again.</span>').children('span').delay(4000).fadeOut(500);							return false;						}					} else {//no first name						$('#errorHolder').html('<span>You must include your first name. Please try again.</span>').children('span').delay(2000).fadeOut(500);						return false;					}				};			</script>		</body>		</html>	<?php }?>